# UBUNTU 24.04 VERSION 1
autoinstall:
  version: 1

  # Coletar informações interativas (early-commands)
  early-commands:
    - |
      # Solicitar nome de usuário
      read -p "Digite o nome de usuário: " USERNAME
      # Solicitar hostname
      read -p "Digite o hostname: " HOSTNAME
      # Solicitar senha
      read -s -p "Digite a senha: " PASSWORD
      echo  # Nova linha após a senha
      # Salvar as variáveis para uso posterior
      echo "username: $USERNAME" > /autoinstall-user-input.yaml
      echo "hostname: $HOSTNAME" >> /autoinstall-user-input.yaml
      echo "password: $PASSWORD" >> /autoinstall-user-input.yaml

  # Configuração do usuário e hostname
  identity:
    hostname: $(cat /autoinstall-user-input.yaml | grep hostname | cut -d' ' -f2)
    username: $(cat /autoinstall-user-input.yaml | grep username | cut -d' ' -f2)
    password: "$6$exemplo$hashedpassword"  # Substitua pelo hash da senha

  # Configurações de localização
  locale: pt_BR.UTF-8

  # Configuração de fuso horário
  timezone: America/Sao_Paulo

  # Configuração de armazenamento
  #storage:
  #  layout: lvm
  #  encryption:
  #    enable: true
  #    passphrase: ""  # Será solicitado ao usuário

  # Pacotes que são instalados com o sistema de pacotes apt
  packages:
    - git
    - wget
    - curl
    - mdatp

  # Instalação de codecs e drivers do sistema
  codecs:
    install: true

  drivers:
    install: true

  # Atualizações
  updates: all

  # Script personalizado para instalar o AnyDesk, Google Chrome e VSCode
  runcmd:
    # Instalação do Google Chrome
    - wget -O /tmp/google-chrome-stable_current_amd64.deb "https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb"
    - sudo dpkg -i /tmp/google-chrome-stable_current_amd64.deb
    - rm /tmp/google-chrome-stable_current_amd64.deb  # Remover o arquivo .deb após a instalação

    # Instalação do AnyDesk
    - BLOBURL="https://ticorpfilestorage.blob.core.windows.net/varoa/Linux/Script%20Onboarding/"
    - FILENAME="AnyDeskClient.deb"
    - SASTOKEN="?si=Automate&sv=2022-11-02&sr=b&sig=fOYBnODf%2B%2FsAgK7M5KIZ845ot0frkdjUH%2FqjxB%2BdbMc%3D"
    - FILEPATH="/tmp/$FILENAME"
    - wget -O "$FILEPATH" "${BLOBURL}${FILENAME}${SASTOKEN}"
    - sudo dpkg -i "$FILEPATH"
    - rm "$FILEPATH"  # Remover o arquivo .deb após a instalação

    # Instalação do VSCode via Pacote .deb (recomendado)
    - wget -O /tmp/vscode.deb "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64"
    - sudo dpkg -i /tmp/vscode.deb
    - rm /tmp/vscode.deb  # Remover o arquivo .deb após a instalação
