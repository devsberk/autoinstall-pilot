# UBUNTU 24.04 VERSION 1
# Define teclado, fuso horário, hostname, usuário, e instala pacotes

autoinstall:
  version: 1
  identity:
    hostname: "ubuntu-host"  # Será solicitado ao usuário
    realname: "Usuário"
    username: "user"  # Será solicitado ao usuário
    password: ""  # Será solicitado ao usuário

  locale: pt_BR.UTF-8
  keyboard:
    layout: br
    variant: abnt2

  timezone: America/Sao_Paulo

  storage:
    layout: lvm
    encryption:
      enable: true
      passphrase: ""  # Será solicitado ao usuário

  # Downloads and runs do script de homologação em segundo plano.
  # user-data:
  #   late-commands:
  #     # Comando para baixar e rodar o script em segundo plano
  #     - curtin in-target -- sh -c "
  #         curl -o /tmp/Linux.sh 'https://ticorpfilestorage.blob.core.windows.net/linux-scripts/Linux.sh' &&
  #         chmod +x /tmp/Linux.sh &&
  #         nohup sudo /tmp/Linux.sh > /var/log/script_install.log 2>&1 &"

  # Pacotes que são instalados com o sistema de pacotes apt
  packages:
    - git
    - wget
    - curl
    - mdatp

  # Pacotes via snap
  # snaps:
  #   - name: spotify
  #     channel: stable
  #     classic: false

  # Instalação de codecs e drivers do sistema
  codecs:
    install: true

  drivers:
    install: true

  updates: all

  # Script personalizado para instalar o AnyDesk, Google Chrome e VSCode
  runcmd:
    # Instalação do Google Chrome
    - wget -O /tmp/google-chrome-stable_current_amd64.deb "https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb"
    - sudo dpkg -i /tmp/google-chrome-stable_current_amd64.deb
    - sudo apt-get install -f -y  # Corrigir dependências, se necessário
    - rm /tmp/google-chrome-stable_current_amd64.deb  # Remover o arquivo .deb após a instalação

    # Instalação do AnyDesk
    - BLOBURL="https://ticorpfilestorage.blob.core.windows.net/varoa/Linux/Script%20Onboarding/"
    - FILENAME="AnyDeskClient.deb"
    - SASTOKEN="?si=Automate&sv=2022-11-02&sr=b&sig=fOYBnODf%2B%2FsAgK7M5KIZ845ot0frkdjUH%2FqjxB%2BdbMc%3D"
    - FILEPATH="/tmp/$FILENAME"
    - wget -O "$FILEPATH" "${BLOBURL}${FILENAME}${SASTOKEN}"
    - sudo dpkg -i "$FILEPATH"
    - sudo apt-get install -f -y  # Corrigir dependências, se necessário
    - rm "$FILEPATH"  # Remover o arquivo .deb após a instalação

    # Instalação do VSCode via Pacote .deb (recomendado)
    - wget -O /tmp/vscode.deb "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64"
    - sudo dpkg -i /tmp/vscode.deb
    - sudo apt-get install -f -y  # Corrigir dependências, se necessário
    - rm /tmp/vscode.deb  # Remover o arquivo .deb após a instalação
