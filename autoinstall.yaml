# autoinstall.yaml
autoinstall:
  version: 1

  identity:
    hostname: "meu-hostname"
    username: "mutley"
    password: ""  # Defina uma senha aqui ou use um hash de senha

  locale: pt_BR.UTF-8
  keyboard:
    layout: br
  timezone: America/Sao_Paulo

  storage:
    layout:
      name: lvm
      sizing-policy: all
      encrypt: true
      password: "mutley"  # Senha temporária
    config:
      - type: disk
        id: disk-sda
        ptable: gpt
        match:
          size: largest
        wipe: superblock

      - type: partition
        id: partition-boot
        device: disk-sda
        size: 512M
        flag: boot
        grub_device: true

      - type: partition
        id: partition-crypto
        device: disk-sda
        size: -1
        flag: crypt

      - type: lvm_volgroup
        id: vg-root
        devices:
          - partition-crypto
        name: vg-root

      - type: lvm_partition
        id: lv-root
        volgroup: vg-root
        size: 100%
        name: lv-root

      - type: format
        id: format-root
        volume: lv-root
        fstype: ext4
        label: root

      - type: mount
        id: mount-root
        device: format-root
        path: /

  packages:
    - git
    - wget
    - curl
    - unzip
    - realmd
    - sssd
    - adcli
    - krb5-user
    - samba-common-bin
    - oddjob
    - oddjob-mkhomedir
    - packagekit
    - sssd-ad
    - sssd-tools
    - openssh-server
    - landscape-client 

  codecs:
    install: true
  drivers:
    install: true

  late-commands:
    # Baixar e executar o script de instalação personalizado
    - curtin in-target -- wget -O /tmp/install-packages.sh https://raw.githubusercontent.com/devsberk/autoinstall-pilot/refs/heads/main/install-packages.sh
    - curtin in-target -- chmod +x /tmp/install-packages.sh
    - curtin in-target -- /tmp/install-packages.sh
